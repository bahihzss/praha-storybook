# Storybook

## 課題３

### Storybook で開発するメリット
* コンポーネント単位での検証が可能になる
* コンポーネント同士が疎結合になる
* スナップショットテストなどの基盤にできる

### Storybook で開発するデメリット
* ストーリーの保守にコストがかかる
* Atomic Design などにこだわりすぎて必要以上に細かいコンポーネント分割を行ってしまうことがある
* アプリとは別の React で動いているので、バージョンの不整合とか起きやすい
* Vue で使うと React のモノを無理やり対応させている感がある（より保守コストがかかる）

### Storybook クイズ
* Storybook における CSF とは何を目的としたどんなモノでしょう？
* .storybook ディレクトリにある main.js, preview.js はそれぞれどういった設定を記述するファイルでしょう？
* Storybook における decorator とはどういうモノでしょう？


# スナップショットテスト

## 課題１

### スナップショットテストとは
* ReactやVue等のコンポーネントで生成するUIが、前回実行時と変わっていないかをチェックするテスト

### スナップショットで防止できる不具合
* ステート stock は在庫を文字列で格納していたが、数値型に修正した。すると、在庫切れ判定ロジックの stock === "0" が常に false になり在庫切れのストーリーで「在庫切れ」の文字列が表示されなくなった。
* jQuery ライブラリをラップしたようなコンポーネントでも変更を検知できる（やらないでいいなら、やらん方がいいけど）
* useRef を使って子コンポーネント内の DOM を操作している場合でも変更を検知できる（やらないでいいなら、やらん方がいいけど）

### スナップショットテストで防止できない不具合
* ボタンの color=primary の色を青から赤に変えた、本来青のままでいて欲しいボタンが赤色になった
* イベントハンドラーにバグが混入していて、ボタンをクリックしても動かなくなっていた
* 非同期にデータを読み込むコンポーネントの読み込み後の表示に不具合があった

## 課題３

### スナップショットテストクイズ
* StoryShot 以外でスナップショットテストを行うにはどのような方法がありますか？
* 広義におけるスナップショットとはどういうものですか？
* スナップショットテストを CI 上で行うにはどのような方法がありますか？

# ビジュアルリグレッションテスト

## 課題２

* スナップショットテスト
  * メリット
    * 文言の変更などはVRTよりわかりやすい
  * デメリット
    * リネームなどのリファクタリングで差分が発生しまくる
* ビジュアルリグレッションテスト
  * メリット
    * スタイルの変更なども検出できる
  * デメリット
    * 変更に影響している要素がわかりづらい

## 課題３

### ビジュアルリグレッションテストクイズ
* storyshot-puppeteer 以外でビジュアルリグレッションテストを行うにはどのような方法がありますか？
* ビジュアルリグレッションテストを CI 上で行うにはどのような方法がありますか？
* VRT では大きなリソースを必要とするなど、レンダリングに時間がかかるstoryだとスナップショットが撮られるタイミングのズレなどを理由に、予期せぬ実行結果になる可能性があります。これを防ぐにはどういった方法がありますか？

# E2Eテスト

## 課題１

### presentational/containerの分け方が陳腐化しつつあることに関する感想

* ロジックと表示の分離は custom hooks でできる
* ストーリ上で表示する場合の特定の状態の再現は msw や Storybook の play でできる
* presentational/container はバケツリレーが発生する上にコード量も多くなる

## 課題２

### E2Eテストのメリット・デメリット

* メリット
  * ユーザーの操作に近い方法でテストができる
  * 表示してみないとわからない問題を発見できる（モーダルでボタンが隠れているなど）
* デメリット
  * テストケースあたりのコストが大きい
  * テストケースが多岐に渡るので設計が難しい

### テスト手法を選定する基準

単体テストは外部プロセスへの依存がないテストのことを指すものとする

* 外部プロセスへの依存がない箇所へのテスト
  * 単体＞E2E　統合
  * 相当込み入ったロジックのテストとかでない限りは単体テストでいいと思う
  * 外部プロセスへの依存がないので統合テストは書けない
  * E2Eでもかけるけど冗長かな
* テストケースが膨大な場合のテスト
  * 単体＞統合＞E2E
  * プロパティベースでテストするなどは実行速度の短い単体テストが最適
  * 逆にE2Eテストや統合テストは外部プロセスへ想定外の負荷をかけてしまう可能性があるので注意が必要
* ユースケースに対するテスト
  * 統合＞E2E＞単体
  * ユースケースは各依存モジュールを呼び出し、処理の手順を記述することが目的
  * なので、各依存モジュールが本来の使用で正しく作用し合うかどうかテストできる必要がある
  * 大抵の場合は統合テストで問題ないと考えられるが、場合によっては E2E テストで書くのも良さそう

### E2E テストにおける要素の選択
#### class を使う場合の問題点
* デザインの変更で対象のクラスが消える可能性がある
* 対象が複数になる可能性がある

#### id を使う場合の問題点
* プロダクションコードで使用する属性なので、仕様の変更で書き換えが必要な場合にテストコードで使用している全てのセレクタを変更する必要が出てくる。

#### 要素の文言を識別子に使う場合の問題点
* 同様の意味の別の言葉に変えた時にテストが通らなくなる
* 逆にそれを検知したい場合は要素の文言を使うのがいい
* そもそも文言がない要素を選択できない

#### どのようにすればいい？
* 対象要素に含まれるテキストの変更を検知したい場合は要素の文言
* そうでない場合は data-testid などの属性を用いる（testing-library の仕様を考えると data-e2e よりこっちが良さげ）

# 課題４
* REST API における E2E テストはどのようなものになりますか？
* Cypress 以外に E2E テストを記述するツールは何がありますか？
  * Playwright 使ったことありますか？（勝手に気になってる）
* DB などのが関わってくる場合はどうすればいいですか？
  * https://learn.cypress.io/advanced-cypress-concepts/database-initialization-and-seeding